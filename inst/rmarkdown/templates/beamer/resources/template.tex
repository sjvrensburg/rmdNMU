% Beamer slides template
% ./inst/rmarkdown/templates/beamer/resources/template.tex
%
% ARCHITECTURE NOTES:
% This template now inherits from base_template.tex for Pandoc compatibility.
% - Base template handles conditional loading to avoid Beamer conflicts
% - Universal command definitions prevent redefinition errors
% - Beamer-specific styling and configuration remain in this file
%
% COMPATIBILITY:
% - Inherits universal Pandoc compatibility from base_template.tex
% - Maintains NMU branding and Beamer-specific features
% - TikZ and PGFPlots configurations for mathematical presentations

\documentclass[$if(fontsize)$$fontsize$,$endif$$if(handout)$handout,$endif$$if(beamer)$ignorenonframetext,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{beamer}

% Beamer Theme Configuration
\usetheme{Madrid}
\useinnertheme{rectangles}
\useoutertheme{miniframes}

% NMU Color Definitions
\definecolor{nmuprimaryblue}{HTML}{141C2B}
\definecolor{nmusecondaryblue}{HTML}{132E51}
\definecolor{nmuyellow}{HTML}{FFCC00}
\definecolor{nmusecondaryyellow}{HTML}{F9B22A}
\definecolor{nmuhumanities}{HTML}{FFB51B}
\definecolor{nmueducation}{HTML}{F14F13}
\definecolor{nmubusiness}{HTML}{6C284F}
\definecolor{nmusciences}{HTML}{006B34}
\definecolor{nmuhealth}{HTML}{82B74A}
\definecolor{nmuengineering}{HTML}{57BCE9}
\definecolor{nmulaw}{HTML}{5E6EBA}
\definecolor{nmuocean}{HTML}{00AFAA}

% Font and Language Support
\usepackage{fontspec}
\usepackage{polyglossia}
\setmainlanguage{english}

% Font Setup
\setmainfont{Nunito Sans}[
    Extension = .ttf,
    Path = $fontdir$/,
    UprightFont = NunitoSans-Regular,
    ItalicFont = NunitoSans-Italic,
    BoldFont = NunitoSans-Regular,
    BoldItalicFont = NunitoSans-Italic,
    UprightFeatures = {Weight=450, Scale=1.0},
    BoldFeatures = {Weight=700},
    ItalicFeatures = {Weight=450},
    BoldItalicFeatures = {Weight=700}
]

\usepackage[Scale=0.98,math-style=french]{lete-sans-math}

% Theme Color Selection
\definecolor{current@themecolor}{named}{nmu$nmu_theme$}

% Inner theme customization for faculty colors
\setbeamercolor{block title}{bg=current@themecolor,fg=white}
\setbeamercolor{block body}{bg=current@themecolor!10,fg=black}
\setbeamercolor{normal text}{fg=nmuprimaryblue}
\setbeamercolor{alerted text}{fg=current@themecolor}
\setbeamercolor{example text}{fg=current@themecolor}

% Color and Style Configuration
\setbeamercolor{palette primary}{bg=current@themecolor,fg=white}
\setbeamercolor{palette secondary}{bg=current@themecolor!70,fg=white}
\setbeamercolor{palette tertiary}{bg=current@themecolor!60,fg=white}
\setbeamercolor{frametitle}{fg=current@themecolor,bg=white}
\setbeamercolor{title}{fg=current@themecolor,bg=white}
\setbeamercolor{itemize item}{fg=current@themecolor}
\setbeamercolor{itemize subitem}{fg=current@themecolor!70}
\setbeamercolor{item projected}{bg=current@themecolor}
\setbeamercolor{section in head/foot}{fg=white,bg=current@themecolor}
\setbeamercolor{description item}{fg=current@themecolor}

% Navigation and Frame Style
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{itemize items}[circle]
\setbeamertemplate{sections/subsections in toc}[circle]
\setbeamertemplate{caption}[numbered]

% Title Page Customization
\setbeamertemplate{title page}{
  \vbox{}
  \vfill
  \begingroup
    \centering
    \begin{minipage}{\textwidth}
      \centerline{\includegraphics[width=0.6\textwidth]{$logo$}}\par % Centered logo
      \vspace{2em}
      {\usebeamerfont{title}\usebeamercolor[fg]{title}\inserttitle\par}
      \vspace{0.5em}
      {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}
      \vspace{1.5em}
      {\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}
      \vspace{0.5em}
      {\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}
      \vspace{0.5em}
      {\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}
    \end{minipage}
  \endgroup
  \vfill
}

% Frame Title Style
\setbeamertemplate{frametitle}{
  \vspace{0.5em}
  \insertframetitle
  \vspace{0.5em}
  \hrule height 0.5pt
}

% Footer Style
\setbeamertemplate{footline}{
  \leavevmode
  \hbox{
    \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,left]{}\hspace*{2em}
      \insertshortauthor
    \end{beamercolorbox}
    \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.25ex,dp=1ex,center]{}
      \insertshorttitle
    \end{beamercolorbox}
    \begin{beamercolorbox}[wd=.25\paperwidth,ht=2.25ex,dp=1ex,right]{}
      \insertframenumber{} / \inserttotalframenumber\hspace*{2em}
    \end{beamercolorbox}
  }
}

\setbeamerfont{description item}{series=\bfseries}

% Additional Packages
\usepackage{amssymb,amsmath}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{color}
\usepackage{xcolor}
\usepackage{tikz}
\usepackage{emoji}

% Load base template for Pandoc compatibility
\input{$base_template$}

\title{$if(title)$$title$$else$NMU Presentation$endif$}
\subtitle{$if(subtitle)$$subtitle$$else$$endif$}
\author{$if(author)$$author$$else$NMU Presenter$endif$}
\institute{$if(institute)$$institute$$else$Nelson Mandela University$endif$}
\date{$if(date)$$date$$else$$endif$}

\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}

% Essential TikZ libraries
\usetikzlibrary{
    % Core functionality
    arrows.meta,          % Enhanced arrow tips
    calc,                % Coordinate calculations
    intersections,       % Find intersections of paths
    % Mathematical constructs
    angles,              % Draw and mark angles
    quotes,              % Easy angle labeling
    patterns,            % Fill patterns
    decorations.markings,% Path markers and decorations
    % Plotting and graphs
    plotmarks,           % Special markers for plots
    positioning,         % Relative positioning
    fit,                % Fit shapes to sets of coordinates
    % Shapes and nodes
    shapes.geometric,    % Basic geometric shapes
    shapes.arrows,       % Arrow shapes
    shapes.symbols,      % Mathematical symbols
    shapes.misc,        % Miscellaneous shapes
    % Specialized features
    matrix,             % Matrix arrangements
    automata,           % State machines and graphs
    bending,            % Path bending
    backgrounds,        % Background layers
    chains,             % Linked nodes
    % Scientific/Mathematical
    circuits.ee.IEC,    % Electrical circuits
    datavisualization,  % Advanced data plotting
    math,               % Mathematical symbols and notation
    trees               % Tree structures
}

% PGFPlots styles and configuration
\pgfplotsset{
    % Default options for plots
    every axis/.append style={
        % Lines and ticks
        axis lines=middle,
        tick align=outside,
        % Labels
        xlabel near ticks,
        ylabel near ticks,
        % Grid
        grid=major,
        grid style={gray!30},
        % Size
        width=0.8\textwidth,
        height=0.6\textwidth,
        % Tick label style
        tick label style={font=\small},
        % Legend
        legend style={
            font=\small,
            cells={anchor=west}
        }
    }
}

% Custom TikZ styles for common elements
\tikzset{
    % Node styles
    important node/.style={
        rectangle,
        rounded corners,
        draw=nmuprimaryblue,
        fill=white,
        thick,
        inner sep=5pt
    },
    % Arrow styles
    math arrow/.style={
        ->,
        >=latex,
        thick
    },
    % Connection styles
    connection/.style={
        draw,
        -latex,
        thick
    },
    % Custom coordinate system for plots
    coords/.style={
        color=nmuprimaryblue,
        mark=*,
        thick
    }
}

\newcommand{\myrule} [3] [] {
  \begin{center}
    \begin{tikzpicture}
      \draw[#2-#3, thick, #1] (0, 0) to (0.9\linewidth, 0);
    \end{tikzpicture}
  \end{center}
}

% Code Highlighting
$if(highlighting-macros)$
$highlighting-macros$
$endif$

\begin{document}

\begin{frame}[plain]
  \titlepage
\end{frame}

$if(toc)$
\begin{frame}[allowframebreaks]{Table of Contents}
\tableofcontents
\end{frame}
$endif$

$body$

\end{document}
