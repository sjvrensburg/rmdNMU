\documentclass[
$if(fontsize)$
  $fontsize$,
$endif$
$if(papersize)$
  $papersize$,
$endif$
$for(classoption)$
  $classoption$,
$endfor$
]{$documentclass$}

% Load Pandoc compatibility layer first
\makeatletter
\def\resourcepath{$resourcepath$}
\makeatother
\input{$resourcepath$/common/pandoc-compat.tex}

% Load base template with common packages
\input{$base_template$}

\setmainfont{Nunito Sans}[
    Extension = .ttf,
    Path = $fontdir$/,
    UprightFont = NunitoSans-Regular,
    ItalicFont = NunitoSans-Italic,
    BoldFont = NunitoSans-Regular,
    BoldItalicFont = NunitoSans-Italic,
    UprightFeatures = {Weight=450, Scale=1.0},
    BoldFeatures = {Weight=700},
    ItalicFeatures = {Weight=450},
    BoldItalicFeatures = {Weight=700}
]

% URL styling
\urlstyle{same}

% Load the preamble with custom environments and styles
$header-includes$

% PDF metadata
\hypersetup{
  pdftitle={$title-meta$},
  pdfauthor={$author-meta$},
  hidelinks,
  pdfcreator={LaTeX via pandoc}
}

% Bibliography setup if needed
$if(bibliography)$
\usepackage[
   backend=biber,
   $if(biblatex-style)$
   style=$biblatex-style$,
   $endif$
   $if(biblio-style)$
   style=$biblio-style$,
   $endif$
   $if(csl)$
   style=authoryear,
   $endif$
   sorting=none
]{biblatex}
$if(bibliography)$
\addbibresource{$bibliography$}
$endif$
$endif$

% Title information
\title{$title$}
\author{$author$}
\date{$date$}

% Code highlighting
$if(highlighting-macros)$
$highlighting-macros$
$endif$

\sloppy

\begin{document}

\maketitle

$body$

$if(bibliography)$
\printbibliography
$endif$

\end{document}
